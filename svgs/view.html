<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Quick Learn</title>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'VT323', monospace;
			padding: 20px;
			background-color: #1a1a2e;
			background-image:
				radial-gradient(circle at top left, #e94560, transparent 40%),
				radial-gradient(circle at bottom right, #0f3460, transparent 40%);
			background-attachment: fixed;
			color: #f0f0f0;
		}

		.header {
			max-width: 1400px;
			margin: 0 auto 40px;
			text-align: center;
		}

		h1 {
			color: #e94560;
			margin-bottom: 25px;
			font-size: 4em;
			text-shadow:
				3px 3px 0px #0f3460,
				-3px -3px 0px #16213e;
			letter-spacing: 3px;
		}

		.search-bar {
			width: 100%;
			padding: 15px 25px;
			font-size: 20px;
			border: 3px solid #533483;
			border-radius: 50px;
			outline: none;
			background: #16213e;
			color: #f0f0f0;
			font-family: 'VT323', monospace;
			box-shadow: inset 0 0 10px #00000080, 0 4px 8px rgba(0,0,0,0.3);
			transition: all 0.3s ease;
		}

		.search-bar::placeholder {
			color: #a0a0a0;
		}

		.search-bar:focus {
			border-color: #e94560;
			box-shadow: inset 0 0 15px #000000, 0 0 15px #e94560;
		}

		.svg-grid {
			max-width: 1400px;
			margin: 0 auto;
			column-count: 5;
			column-gap: 20px;
		}

		@media (max-width: 1200px) { .svg-grid { column-count: 4; } }
		@media (max-width: 900px) { .svg-grid { column-count: 3; } }
		@media (max-width: 600px) { .svg-grid { column-count: 2; } }

		.svg-item {
			break-inside: avoid;
			margin-bottom: 20px;
			background: #16213e;
			border-radius: 15px;
			overflow: hidden;
			box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4);
			cursor: pointer;
			transition: transform 0.2s ease, box-shadow 0.2s ease;
			border: 2px solid #533483;
		}

		.svg-item:hover {
			transform: translateY(-5px) scale(1.02);
			box-shadow: 0 12px 25px rgba(0, 0, 0, 0.6);
			border-color: #e94560;
		}

		.svg-item img {
			width: 100%;
			height: auto;
			display: block;
			background-color: #f0f0f0;
		}

		.svg-name {
			padding: 15px;
			font-size: 16px;
			color: #f0f0f0;
			background: #0f3460;
			text-align: center;
		}

		.modal {
			display: none;
			position: fixed;
			top: 0; left: 0;
			width: 100%; height: 100%;
			background: rgba(15, 52, 96, 0.9);
			backdrop-filter: blur(8px);
			z-index: 1000;
			justify-content: center;
			align-items: center;
		}

		.modal.active { display: flex; }

		.modal-content {
			position: relative;
			width: 90%;
			height: 90%;
			overflow: hidden;
			cursor: grab;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.modal-content:active { cursor: grabbing; }

		.modal-image {
			max-width: 100%;
			max-height: 100%;
			transition: transform 0.1s ease-out;
			user-select: none;
			-webkit-user-select: none;
			transform-origin: center center;
			background: white;
			border-radius: 10px;
			box-shadow: 0 0 40px #e94560, 0 0 60px #1a1a2e;
		}

		.modal-close {
			position: absolute;
			top: 25px;
			right: 25px;
			font-size: 40px;
			color: #f0f0f0;
			cursor: pointer;
			z-index: 1001;
			width: 50px;
			height: 50px;
			display: flex;
			align-items: center;
			justify-content: center;
			background: #e94560;
			border-radius: 50%;
			transition: all 0.2s ease;
			line-height: 1;
		}

		.modal-close:hover {
			background: #f0f0f0;
			color: #e94560;
			transform: rotate(90deg);
		}

		.zoom-controls {
			position: absolute;
			bottom: 30px;
			left: 50%;
			transform: translateX(-50%);
			display: flex;
			gap: 15px;
			z-index: 1001;
			background: rgba(22, 33, 62, 0.8);
			padding: 10px;
			border-radius: 50px;
		}

		.zoom-btn {
			width: 50px;
			height: 50px;
			background: #16213e;
			color: #f0f0f0;
			border: 2px solid #533483;
			border-radius: 50%;
			font-size: 28px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s ease;
			font-family: 'VT323', monospace;
		}

		.zoom-btn:hover {
			background: #e94560;
			border-color: #e94560;
			color: #16213e;
			transform: scale(1.1);
		}

		.error, .loading {
			color: #e94560;
			text-align: center;
			padding: 40px;
			font-size: 24px;
			background: #16213e;
			border-radius: 15px;
		}
	</style>
</head>

<body>
	<div class="header">
		<h1>Quick Learn</h1>
		<input type="text" class="search-bar" id="searchBar" placeholder="Search for a concept...">
	</div>

	<div class="svg-grid" id="svgGrid">
		<div class="loading">Loading concepts...</div>
	</div>

	<div class="modal" id="modal">
		<span class="modal-close" id="modalClose">&times;</span>
		<div class="modal-content" id="modalContent">
			<img class="modal-image" id="modalImage" src="" alt="">
		</div>
		<div class="zoom-controls">
			<button class="zoom-btn" id="zoomOut">−</button>
			<button class="zoom-btn" id="zoomReset">⟲</button>
			<button class="zoom-btn" id="zoomIn">+</button>
		</div>
	</div>

	<script>
		const repoUrl = 'https://raw.githubusercontent.com/jebin2/blog/main/manifest.json?timestamp='+new Date().getTime();
		const svgGrid = document.getElementById('svgGrid');
		const searchBar = document.getElementById('searchBar');
		const modal = document.getElementById('modal');
		const modalImage = document.getElementById('modalImage');
		const modalContent = document.getElementById('modalContent');
		const modalClose = document.getElementById('modalClose');
		const zoomIn = document.getElementById('zoomIn');
		const zoomOut = document.getElementById('zoomOut');
		const zoomReset = document.getElementById('zoomReset');

		let allSvgs = [];
		let scale = 1;
		let translateX = 0;
		let translateY = 0;
		let isDragging = false;
		let startX, startY;

		async function loadSVGs() {
			try {
				const response = await fetch(repoUrl);
				const manifest = await response.json();
				allSvgs = manifest.svgs;

				displaySVGs(allSvgs);
			} catch (err) {
				svgGrid.innerHTML = `<div class="error">Error loading concepts: ${err.message}</div>`;
			}
		}

		// --- URL Management ---
		function checkUrlParameter() {
			const urlParams = new URLSearchParams(window.location.search);
			const srcParam = urlParams.get('src');
			if (srcParam) {
				const fullPath = `https://raw.githubusercontent.com/jebin2/blog/main/${srcParam}`;
				openModal(fullPath, srcParam);
			}
		}

		function updateUrl(svgPath) {
			const url = new URL(window.location);
			url.searchParams.set('src', svgPath);
			window.history.pushState({}, '', url);
		}

		function clearUrl() {
			const url = new URL(window.location);
			url.searchParams.delete('src');
			window.history.pushState({}, '', url);
		}

		function displaySVGs(svgs) {
			svgGrid.innerHTML = '';

			if (svgs.length === 0) {
				svgGrid.innerHTML = '<div class="error">No concepts found</div>';
				return;
			}

			svgs.forEach(svg => {
				const item = document.createElement('div');
				item.className = 'svg-item';

				const img = document.createElement('img');
				img.src = `https://raw.githubusercontent.com/jebin2/blog/main/${svg.path}`;
				img.alt = svg.name;
				img.loading = 'lazy';

				const name = document.createElement('div');
				name.className = 'svg-name';
				name.textContent = svg.name;

				item.appendChild(img);
				item.appendChild(name);
				item.addEventListener('click', () => openModal(img.src, svg.path));

				svgGrid.appendChild(item);
			});
		}

		function openModal(src, srcParam) {
			updateUrl(srcParam);
			modalImage.src = src;
			modal.classList.add('active');
			resetZoom();
			document.body.style.overflow = 'hidden';

			// Wait for image to load to get correct dimensions
			modalImage.onload = () => {
				resetZoom();
			};
		}

		function closeModal() {
			modal.classList.remove('active');
			document.body.style.overflow = 'auto';
			clearUrl();
		}

		function updateTransform() {
			modalImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
		}

		function resetZoom() {
			scale = 1;
			translateX = 0;
			translateY = 0;
			updateTransform();
		}

		// Search functionality
		searchBar.addEventListener('input', (e) => {
			const searchTerm = e.target.value.toLowerCase();
			const filtered = allSvgs.filter(svg =>
				svg.name.toLowerCase().includes(searchTerm) ||
				svg.path.toLowerCase().includes(searchTerm)
			);
			displaySVGs(filtered);
		});

		// Modal controls
		modalClose.addEventListener('click', closeModal);
		modal.addEventListener('click', (e) => {
			if (e.target === modal) closeModal();
		});

		zoomIn.addEventListener('click', () => {
			scale = Math.min(scale + 0.2, 5);
			updateTransform();
		});

		zoomOut.addEventListener('click', () => {
			scale = Math.max(scale - 0.2, 0.5);
			updateTransform();
		});

		zoomReset.addEventListener('click', resetZoom);

		// Wheel zoom with cursor point
		modalContent.addEventListener('wheel', (e) => {
			e.preventDefault();

			// Get mouse position relative to the image element
			const imgRect = modalImage.getBoundingClientRect();
			const mouseX = e.clientX - imgRect.left;
			const mouseY = e.clientY - imgRect.top;

			// Current image dimensions
			const currentWidth = imgRect.width;
			const currentHeight = imgRect.height;

			const delta = e.deltaY > 0 ? -0.1 : 0.1;
			const newScale = Math.max(0.5, Math.min(5, scale + delta));

			// Calculate the ratio of mouse position within the image
			const ratioX = mouseX / currentWidth;
			const ratioY = mouseY / currentHeight;

			// Calculate how much the image will grow/shrink
			const scaleDiff = newScale - scale;

			// Adjust translation to keep the point under cursor fixed
			translateX -= (mouseX - currentWidth / 2) * scaleDiff / scale;
			translateY -= (mouseY - currentHeight / 2) * scaleDiff / scale;

			scale = newScale;
			updateTransform();
		});

		// Drag functionality
		modalContent.addEventListener('mousedown', (e) => {
			if (e.target === modalImage || e.target === modalContent) {
				e.preventDefault();
				isDragging = true;
				startX = e.clientX - translateX;
				startY = e.clientY - translateY;
				modalContent.style.cursor = 'grabbing';
			}
		});

		document.addEventListener('mousemove', (e) => {
			if (isDragging) {
				e.preventDefault();
				translateX = e.clientX - startX;
				translateY = e.clientY - startY;
				updateTransform();
			}
		});

		document.addEventListener('mouseup', () => {
			if (isDragging) {
				isDragging = false;
				modalContent.style.cursor = 'grab';
			}
		});

		// Touch support
		let touchStartX, touchStartY, touchStartDist;

		modalContent.addEventListener('touchstart', (e) => {
			if (e.touches.length === 1) {
				isDragging = true;
				touchStartX = e.touches[0].clientX - translateX;
				touchStartY = e.touches[0].clientY - translateY;
			} else if (e.touches.length === 2) {
				isDragging = false;
				touchStartDist = Math.hypot(
					e.touches[0].clientX - e.touches[1].clientX,
					e.touches[0].clientY - e.touches[1].clientY
				);
			}
		});

		modalContent.addEventListener('touchmove', (e) => {
			e.preventDefault();
			if (e.touches.length === 1 && isDragging) {
				translateX = e.touches[0].clientX - touchStartX;
				translateY = e.touches[0].clientY - touchStartY;
				updateTransform();
			} else if (e.touches.length === 2) {
				const dist = Math.hypot(
					e.touches[0].clientX - e.touches[1].clientX,
					e.touches[0].clientY - e.touches[1].clientY
				);
				scale = Math.max(0.5, Math.min(5, scale * (dist / touchStartDist)));
				touchStartDist = dist;
				updateTransform();
			}
		});

		modalContent.addEventListener('touchend', () => {
			isDragging = false;
		});

		// Keyboard shortcuts
		document.addEventListener('keydown', (e) => {
			if (!modal.classList.contains('active')) return;

			if (e.key === 'Escape') closeModal();
			if (e.key === '+' || e.key === '=') zoomIn.click();
			if (e.key === '-' || e.key === '_') zoomOut.click();
			if (e.key === '0') resetZoom();
		});

		// Load SVGs on page load
		checkUrlParameter();
		loadSVGs();
	</script>
</body>

</html>