<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="600" y="40" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    ARM Instruction Format (32-bit)
  </text>
  
  <!-- Bit positions at top -->
  <text x="100" y="90" font-family="monospace" font-size="14" fill="#34495e">31</text>
  <text x="245" y="90" font-family="monospace" font-size="14" fill="#34495e">28 27</text>
  <text x="360" y="90" font-family="monospace" font-size="14" fill="#34495e">26 25 24 23 22 21 20 19</text>
  <text x="720" y="90" font-family="monospace" font-size="14" fill="#34495e">16 15</text>
  <text x="890" y="90" font-family="monospace" font-size="14" fill="#34495e">12 11</text>
  <text x="1090" y="90" font-family="monospace" font-size="14" fill="#34495e">0</text>
  
  <!-- Instruction boxes -->
  <!-- cond [31:28] -->
  <rect x="100" y="110" width="160" height="80" fill="#3498db" stroke="#2c3e50" stroke-width="2"/>
  <text x="180" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">cond</text>
  
  <!-- 01 [27:26] -->
  <rect x="260" y="110" width="100" height="80" fill="#95a5a6" stroke="#2c3e50" stroke-width="2"/>
  <text x="310" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">01</text>
  
  <!-- I [25] -->
  <rect x="360" y="110" width="50" height="80" fill="#e74c3c" stroke="#2c3e50" stroke-width="2"/>
  <text x="385" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">I</text>
  
  <!-- P [24] -->
  <rect x="410" y="110" width="50" height="80" fill="#9b59b6" stroke="#2c3e50" stroke-width="2"/>
  <text x="435" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">P</text>
  
  <!-- U [23] -->
  <rect x="460" y="110" width="50" height="80" fill="#8e44ad" stroke="#2c3e50" stroke-width="2"/>
  <text x="485" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">U</text>
  
  <!-- B [22] -->
  <rect x="510" y="110" width="50" height="80" fill="#2980b9" stroke="#2c3e50" stroke-width="2"/>
  <text x="535" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">B</text>
  
  <!-- W [21] -->
  <rect x="560" y="110" width="50" height="80" fill="#c0392b" stroke="#2c3e50" stroke-width="2"/>
  <text x="585" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">W</text>
  
  <!-- L [20] -->
  <rect x="610" y="110" width="50" height="80" fill="#f39c12" stroke="#2c3e50" stroke-width="2"/>
  <text x="635" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">L</text>
  
  <!-- Rn [19:16] -->
  <rect x="660" y="110" width="160" height="80" fill="#1abc9c" stroke="#2c3e50" stroke-width="2"/>
  <text x="740" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">Rn</text>
  
  <!-- Rd [15:12] -->
  <rect x="820" y="110" width="160" height="80" fill="#16a085" stroke="#2c3e50" stroke-width="2"/>
  <text x="900" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">Rd</text>
  
  <!-- Offset12 [11:0] -->
  <rect x="980" y="110" width="160" height="80" fill="#27ae60" stroke="#2c3e50" stroke-width="2"/>
  <text x="1060" y="155" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">Offset12</text>
  
  <!-- Bit range labels below boxes -->
  <text x="180" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[31:28]</text>
  <text x="310" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[27:26]</text>
  <text x="385" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[25]</text>
  <text x="435" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[24]</text>
  <text x="485" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[23]</text>
  <text x="535" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[22]</text>
  <text x="585" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[21]</text>
  <text x="635" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[20]</text>
  <text x="740" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[19:16]</text>
  <text x="900" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[15:12]</text>
  <text x="1060" y="210" font-family="monospace" font-size="12" text-anchor="middle" fill="#34495e">[11:0]</text>
  
  <!-- Key distinction box -->
  <rect x="100" y="240" width="1040" height="70" fill="#ffe6e6" stroke="#c0392b" stroke-width="3" rx="5"/>
  <text x="620" y="265" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#c0392b">
    ⚠️ CRITICAL: Bits [24:21] are NOT opcode in LDR/STR instructions!
  </text>
  <text x="620" y="290" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#7f2020">
    These are addressing mode flags (P, U, B, W). CPU identifies instruction class via bits [27:26] = 01
  </text>
  
  <!-- Field descriptions -->
  <text x="100" y="340" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#2c3e50">Field Descriptions:</text>
  
  <!-- cond -->
  <rect x="110" y="360" width="20" height="20" fill="#3498db"/>
  <text x="140" y="375" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">cond (4 bits):</tspan> Condition code - when to execute
  </text>
  
  <!-- 01 -->
  <rect x="110" y="395" width="20" height="20" fill="#95a5a6"/>
  <text x="140" y="410" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">01 (2 bits):</tspan> Fixed - identifies LDR/STR instruction class
  </text>
  
  <!-- I -->
  <rect x="110" y="430" width="20" height="20" fill="#e74c3c"/>
  <text x="140" y="445" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">I (1 bit):</tspan> 0 = immediate offset, 1 = register offset with shift
  </text>
  
  <!-- P -->
  <rect x="110" y="465" width="20" height="20" fill="#9b59b6"/>
  <text x="140" y="480" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">P (1 bit):</tspan> Pre/Post indexing - 1 = pre-index, 0 = post-index
  </text>
  
  <!-- U -->
  <rect x="110" y="500" width="20" height="20" fill="#8e44ad"/>
  <text x="140" y="515" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">U (1 bit):</tspan> Add/subtract - 1 = add offset, 0 = subtract offset
  </text>
  
  <!-- B -->
  <rect x="110" y="535" width="20" height="20" fill="#2980b9"/>
  <text x="140" y="550" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">B (1 bit):</tspan> Byte/word - 1 = byte transfer, 0 = word transfer
  </text>
  
  <!-- Right column -->
  <!-- W -->
  <rect x="650" y="360" width="20" height="20" fill="#c0392b"/>
  <text x="680" y="375" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">W (1 bit):</tspan> Write-back - 1 = update Rn after transfer
  </text>
  
  <!-- L -->
  <rect x="650" y="395" width="20" height="20" fill="#f39c12"/>
  <text x="680" y="410" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">L (1 bit):</tspan> Load/store - 1 = load (LDR), 0 = store (STR)
  </text>
  
  <!-- Rn -->
  <rect x="650" y="430" width="20" height="20" fill="#1abc9c"/>
  <text x="680" y="445" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">Rn (4 bits):</tspan> Base register (R0-R15, 1111 = PC)
  </text>
  
  <!-- Rd -->
  <rect x="650" y="465" width="20" height="20" fill="#16a085"/>
  <text x="680" y="480" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">Rd (4 bits):</tspan> Destination register (LDR) or source (STR)
  </text>
  
  <!-- Offset12 -->
  <rect x="650" y="500" width="20" height="20" fill="#27ae60"/>
  <text x="680" y="515" font-family="Arial, sans-serif" font-size="14" fill="#2c3e50">
    <tspan font-weight="bold">Offset12 (12 bits):</tspan> 12-bit immediate offset value
  </text>
  <text x="680" y="535" font-family="Arial, sans-serif" font-size="13" fill="#555">
    When I=0: offset value; When I=1: contains register and shift info
  </text>
  
  <!-- Example instruction -->
  <rect x="100" y="570" width="1040" height="210" fill="#e8f8f5" stroke="#16a085" stroke-width="3" rx="5"/>
  <text x="620" y="600" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Example: LDR r0, [PC, #0x20]!
  </text>
  
  <!-- Binary representation -->
  <text x="620" y="630" font-family="monospace" font-size="14" text-anchor="middle" fill="#34495e">
    1110 | 01 | 0 | 1 | 1 | 0 | 1 | 1 | 1111 | 0000 | 000000100000
  </text>
  
  <!-- Field breakdown -->
  <text x="620" y="660" font-family="monospace" font-size="13" text-anchor="middle" fill="#16a085">
    AL | 01 | I=0 | P=1 | U=1 | B=0 | W=1 | L=1 | PC | r0 | 0x20
  </text>
  
  <!-- Detailed explanation -->
  <text x="120" y="690" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• AL (1110):</tspan> Always execute
  </text>
  <text x="120" y="710" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• 01:</tspan> LDR/STR instruction class
  </text>
  <text x="120" y="730" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• I=0:</tspan> Immediate offset in Offset12
  </text>
  <text x="120" y="750" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• P=1:</tspan> Pre-indexed (calculate address before transfer)
  </text>
  
  <text x="620" y="690" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• U=1:</tspan> Add offset to base
  </text>
  <text x="620" y="710" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• B=0:</tspan> Word transfer (32-bit)
  </text>
  <text x="620" y="730" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• W=1:</tspan> Write-back (update PC after load) - the ! symbol
  </text>
  <text x="620" y="750" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• L=1:</tspan> Load operation (LDR, not STR)
  </text>
  
  <text x="950" y="690" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• Rn=1111:</tspan> Base register is PC
  </text>
  <text x="950" y="710" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• Rd=0000:</tspan> Destination is r0
  </text>
  <text x="950" y="730" font-family="Arial, sans-serif" font-size="13" fill="#2c3e50">
    <tspan font-weight="bold">• Offset12=0x20:</tspan> 32 bytes offset
  </text>
  <text x="950" y="750" font-family="Arial, sans-serif" font-size="13" fill="#16a085" font-weight="bold">
    → Load word from [PC + 32] into r0
  </text>
</svg>