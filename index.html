<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Dynamic Markdown Blog</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link id="theme1" rel="stylesheet" href="style.css" disabled>
    <link id="theme2" rel="stylesheet" href="style1.css">
    <style>
        /* Theme Switcher Floating Button */
        #themeSwitcher {
            position: fixed;
            top: 20px;
            /* distance from top */
            right: 20px;
            /* distance from right */
            z-index: 1001;
            /* above other elements */
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--white);
            color: var(--text-primary);
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        /* Hover effect */
        #themeSwitcher:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
            border-color: var(--accent-primary);
        }

        /* Style options */
        #themeSwitcher option {
            padding: 0.5rem;
        }
    </style>
</head>

<body>
    <div class="container" id="content">
        Loading...
    </div>
    <div class="scroll-progress"></div>
    <select id="themeSwitcher">
        <option value="theme2">Theme 2</option>
        <option value="theme1">Theme 1</option>
    </select>

    <!-- Image Modal -->
    <div id="imageModal" class="image-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeImageModal()">&times;</button>
            <div id="modalImageContainer">
                <div class="modal-spinner"></div>
            </div>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const page = params.get('page');

        if (page) {
            // Construct full URL to the Markdown file on GitHub Pages
            const url = `https://jebin2.github.io/blog/${page}`;

            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error('Markdown file not found');
                    return response.text();
                })
                .then(md => {
                    document.getElementById('content').innerHTML = marked.parse(md);
                    setTimeout(() => {
                        create_progressbar();
                        setupImagePopups();
                    }, 500);
                })
                .catch(err => {
                    document.getElementById('content').innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
                });
        } else {
            document.getElementById('content').innerHTML = '<p>No page specified</p>';
        }

        create_progressbar = () => {
            const progressBar = document.querySelector('.scroll-progress');

            window.addEventListener('scroll', () => {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;

                progressBar.style.width = scrolled + '%';
            });
        };
        const themeSwitcher = document.getElementById('themeSwitcher');
        themeSwitcher.addEventListener('change', (e) => {
            const selected = e.target.value;

            // Enable the selected theme and disable the other
            document.getElementById('theme1').disabled = (selected !== 'theme1');
            document.getElementById('theme2').disabled = (selected !== 'theme2');
        });


        // Image popup functionality
        function setupImagePopups() {
            const images = document.querySelectorAll('.container img');

            images.forEach(img => {
                img.addEventListener('click', function () {
                    openImageModal(this.src, this.alt || '');
                });
            });
        }

        function openImageModal(imageSrc, altText) {
            const modal = document.getElementById('imageModal');
            const modalContainer = document.getElementById('modalImageContainer');

            // Show modal
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';

            // Show loading spinner
            modalContainer.innerHTML = '<div class="modal-spinner"></div>';

            // Create new image element
            const modalImg = document.createElement('img');
            modalImg.className = 'modal-image';
            modalImg.alt = altText;

            // Handle image load
            modalImg.onload = function () {
                modalContainer.innerHTML = '';
                modalContainer.appendChild(modalImg);

                // Add caption if alt text exists
                if (altText) {
                    const caption = document.createElement('div');
                    caption.className = 'image-caption';
                    caption.textContent = altText;
                    modalContainer.appendChild(caption);
                }
            };

            // Handle image error
            modalImg.onerror = function () {
                modalContainer.innerHTML = '<div style="color: white; text-align: center; padding: 20px;">Failed to load image</div>';
            };

            // Set image source (this triggers loading)
            modalImg.src = imageSrc;
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        // Close modal when clicking outside the image
        document.getElementById('imageModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeImageModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });

        // Prevent modal from closing when clicking on the modal content
        document.querySelector('.modal-content').addEventListener('click', function (e) {
            e.stopPropagation();
        });
    </script>
</body>

</html>